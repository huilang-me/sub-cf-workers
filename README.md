# Cloudflare Workers è®¢é˜…ç®¡ç†å™¨

è¿™æ˜¯ä¸€ä¸ªåŸºäº **Cloudflare Workers + KV å­˜å‚¨** çš„è½»é‡çº§è®¢é˜…è·³è½¬ç³»ç»Ÿï¼Œæ—¨åœ¨ï¼š

* ç®¡ç†å¤šä¸ªè®¢é˜…åœ°å€
* æ”¯æŒåŠ¨æ€è·³è½¬å¤šç§ä»£ç†èŠ‚ç‚¹
* æä¾›å…è´¹è®¢é˜…æ•´åˆæ–¹æ¡ˆ
* å¹¶é€šè¿‡ `/admin` é¡µé¢å®ç° **åœ¨çº¿ç®¡ç†æ‰€æœ‰è·³è½¬æº**

> âš ï¸ æ‰€æœ‰è¯·æ±‚å‡éœ€æºå¸¦åˆæ³• UUIDï¼Œéæ³•è®¿é—®è¿”å›ä¼ªè£…é¡µæˆ– 404ï¼Œé˜²æ­¢çˆ¬è™«æ¢æµ‹å’Œæ»¥ç”¨ã€‚

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

* âœ… ä½¿ç”¨ URL Path ä¸­çš„ `uuid` ä½œä¸ºå”¯ä¸€è®¿é—®å‡­è¯ï¼Œæœªå‘½ä¸­è¿”å›é»˜è®¤ç«™ç‚¹æˆ– 404
* âœ… è‡ªåŠ¨è¯»å– KV å­˜å‚¨ä¸­çš„è®¢é˜…ä¿¡æ¯ï¼Œå®ç°çµæ´»é…ç½®
* âœ… æ”¯æŒé€šè¿‡ Web è¡¨å•ç®¡ç†æ‰€æœ‰è®¢é˜…åœ°å€ï¼ˆ/uuid/adminï¼‰
* âœ… æ”¯æŒå…è´¹è®¢é˜…ä¸€é”®è·³è½¬ï¼ˆ`free_list`ï¼‰
* âœ… æ”¯æŒé«˜çº§ç»„åˆå‚æ•°ï¼š`sub`ï¼ˆä¼˜é€‰æ¨¡æ¿ï¼‰+ `proxyip`ï¼ˆIPç»‘å®šï¼‰
* âœ… æ‰€æœ‰è·³è½¬å‡ä¸º 302 é‡å®šå‘ï¼Œå®¢æˆ·ç«¯é€æ˜å¤„ç†
* âœ… å®Œæ•´æ”¯æŒ Shadowrocketã€V2RayN ç­‰å®¢æˆ·ç«¯

---

## ğŸ”§ KV é”®è¯´æ˜ï¼ˆéƒ¨ç½²åé€šè¿‡ Web ç®¡ç†ï¼‰

| KV Key         | æè¿°                  |
| -------------- | ------------------- |
| `proxy_list`   | è·¯ç”±è·³è½¬ç›®æ ‡åˆ—è¡¨ï¼Œæ¯è¡Œä¸ºä¸€ä¸ª URL  |
| `sub_list`     | å¯é€‰è®¢é˜…æ¨¡æ¿ï¼ˆç”¨äº `sub` å‚æ•°ï¼‰ |
| `proxyip_list` | å¯é€‰ç»‘å®šçš„ IP æˆ–å­åŸŸå       |
| `free_list`    | å…è´¹è®¢é˜…æºè·³è½¬ç›®æ ‡           |

å¯é€šè¿‡ Web è¡¨å• `/your-uuid/admin` ç¼–è¾‘è¿™äº›å†…å®¹ã€‚

---

## ğŸ§  è·¯ç”±è¯´æ˜

### `GET /{uuid}`

* æ ¡éªŒ UUIDï¼ŒåŒ¹é…åˆ™ç»§ç»­å¤„ç†è¯·æ±‚ï¼ŒæœªåŒ¹é…è¿”å›é»˜è®¤ç«™ç‚¹æˆ– `404`
* æ”¯æŒä»¥ä¸‹ GET å‚æ•°ï¼š

| å‚æ•°        | è¯´æ˜                                           |
| --------- | -------------------------------------------- |
| `id`      | `proxy_list` ä¸­çš„è·³è½¬ç›®æ ‡ç´¢å¼•ï¼ˆå¿…å¡«ï¼Œæˆ–ä½¿ç”¨ `free` æ›¿ä»£ï¼‰      |
| `sub`     | è®¢é˜…æ¨¡æ¿ç´¢å¼•æˆ–å­—ç¬¦ä¸²ï¼Œé™„åŠ ä¸º `?sub=` å‚æ•°                    |
| `proxyip` | IP æ¨¡æ¿ç´¢å¼•æˆ–å­—ç¬¦ä¸²ï¼Œé™„åŠ ä¸º `?proxyip=` å‚æ•°               |
| `free`    | å¯ç”¨å…è´¹è®¢é˜…è·³è½¬ï¼ˆç´¢å¼•ï¼‰ï¼Œæ­¤æ—¶å¿½ç•¥ `id`ï¼Œè·³è½¬åˆ° `free_list[n]` åœ°å€ |

### `GET /{uuid}/admin`

> ç®¡ç†é¢æ¿ï¼ˆéœ€ UUID åŒ¹é…ï¼‰

* æ˜¾ç¤ºå¹¶ç¼–è¾‘ KV ä¸­çš„å››ä¸ªåˆ—è¡¨
* ä¿®æ”¹åæäº¤è‡ªåŠ¨å†™å…¥ KV

---

## ğŸ§ª ç¤ºä¾‹ç”¨æ³•

### ğŸ¯ æ™®é€šè·³è½¬

```
https://your-worker.workers.dev/{uuid}?id=0&sub=1&proxyip=2
â†’ è·³è½¬è‡³ proxy_list[0]?sub=sub_list[1]&proxyip=proxyip_list[2]
```

æˆ–ä½¿ç”¨è‡ªå®šä¹‰å€¼ï¼š

```
https://your-worker.workers.dev/{uuid}?id=1&sub=custom.sub.net&proxyip=ip.custom.net
```

### ğŸ¯ Free æ¨¡å¼ï¼ˆå¿½ç•¥ id å‚æ•°ï¼‰

```
https://your-worker.workers.dev/{uuid}?free=0&sub=sub.example.com&proxyip=ip.example.com
â†’ è·³è½¬è‡³ free_list[0]?sub=...&proxyip=...
```

---

## ğŸ” å…¥å£éªŒè¯æœºåˆ¶

| è·¯å¾„                     | è¡Œä¸º                    |
| ---------------------- | --------------------- |
| `/`                    | è¿”å›ä¼ªè£…çš„å»ºç«™æˆåŠŸé¡µé¢           |
| `/invalid`             | è¿”å›è‡ªå®šä¹‰ nginx æ ·å¼ 404 é¡µé¢ |
| `/your-valid-uuid/...` | ç»§ç»­æ‰§è¡Œé€»è¾‘è·³è½¬              |

---

## ğŸ›  éƒ¨ç½²æŒ‡å—ï¼ˆCloudflare Workersï¼‰

1. æ‰“å¼€ [Cloudflare Dashboard](https://dash.cloudflare.com/)

2. è¿›å…¥ã€ŒWorkers & Pagesã€> åˆ›å»ºåº”ç”¨

3. ä½¿ç”¨æ¨¡æ¿ã€ŒHello Worldã€åˆ›å»º Worker

4. å°†ä»“åº“ä¸­çš„ä»£ç å¤åˆ¶ç²˜è´´æ›¿æ¢é»˜è®¤ä»£ç 

5. åœ¨å·¦ä¾§é…ç½®é¢æ¿ä¸­æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

   * `UUID`ï¼šä½ çš„è®¿é—®å¯†é’¥ï¼ˆå¿…é¡»ä¸º URL-safe å­—ç¬¦ä¸²ï¼‰
   * `PROXY_LIST`: ä»£ç†åœ°å€ï¼Œè¿™é‡Œå†™å…¥çš„è¯ä¸ä¼šè¢«å‰ç«¯ä¿®æ”¹

6. æ·»åŠ  KV å‘½åç©ºé—´ï¼Œå¹¶ç»‘å®šä¸º `KV`ï¼ˆç”¨äºä¿å­˜ proxy/sub ç­‰åˆ—è¡¨ï¼‰

7. ç‚¹å‡»éƒ¨ç½²ï¼Œè®¿é—®è·¯å¾„å¦‚ä¸‹ï¼š

```
https://your-worker.workers.dev/{UUID}/admin
https://your-worker.workers.dev/{UUID}?id=0&sub=1&proxyip=1
https://your-worker.workers.dev/{UUID}?free=0
```

---

## ğŸ“¦ ç¤ºä¾‹ KV å†…å®¹æ ¼å¼

æ¯è¡Œä¸€ä¸ªï¼š

### proxy\_list:

```
https://sub1.example.workers.dev/xxx-xxx-xxx
https://sub2.example.workers.dev/yyy-yyy-yyy
```

### sub\_list:

```
sub.cmliussss.net
owo.o00o.ooo
```

### proxyip\_list:

```
ProxyIP.US.CMLiussss.net
proxyip.example2.net
```

### free\_list:

```
https://raw.githubusercontent.com/aiboboxx/v2rayfree/main/v2
https://mirror.host.com/free
```

---

## ğŸ”§ åœ¨çº¿ç®¡ç†ï¼ˆå¼ºçƒˆæ¨èï¼‰

è®¿é—®ä»¥ä¸‹è·¯å¾„å¯åœ¨çº¿é…ç½®æ‰€æœ‰è®¢é˜…å†…å®¹ï¼š

```
https://your-worker.workers.dev/{uuid}/admin
```

---

## âš ï¸ å…è´£å£°æ˜

> æœ¬é¡¹ç›®ä»…ä¾›**æ•™è‚²ã€ç ”ç©¶ä¸å®‰å…¨æµ‹è¯•**ç›®çš„è€Œè®¾è®¡å’Œå¼€å‘ã€‚
> æ‰€æœ‰è·³è½¬è¡Œä¸ºå‡ä¸ºç”¨æˆ·è‡ªä¸»é…ç½®ï¼Œç³»ç»Ÿæœ¬èº«ä¸å­˜å‚¨ä»»ä½•å®é™…è®¢é˜…å†…å®¹ï¼Œä»…ä½œä¸ºä¸­è½¬è·³è½¬ç”¨é€”ã€‚
> æ‰€æœ‰æ•°æ®å­˜å‚¨äº Cloudflare KVï¼Œ**è¯·å¦¥å–„ä¿ç®¡æ‚¨çš„ UUID ä¸è®¢é˜…æ•°æ®**ï¼Œå¦‚å‘ç”Ÿæ•°æ®ä¸¢å¤±ã€æ³„éœ²ç­‰æƒ…å†µï¼Œå¼€å‘è€…æ¦‚ä¸è´Ÿè´£ã€‚
> è¯·å‹¿å°†æœ¬é¡¹ç›®ç”¨äºä»»ä½•éæ³•ç”¨é€”ï¼Œä½¿ç”¨è€…éœ€è‡ªè¡Œæ‰¿æ‹…ç›¸å…³è´£ä»»ã€‚

---

## â¤ï¸ é¸£è°¢ä¸å‚è€ƒ

* [edgetunnel](https://github.com/cmliu/edgetunnel)
* [Cloudflare Workers](https://developers.cloudflare.com/workers/)

---
